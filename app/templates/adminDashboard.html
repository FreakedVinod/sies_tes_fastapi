<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard</title>
  <link rel="stylesheet" href="{{ url_for('static', path='css/adminDashboard.css') }}">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
</head>
<body>
  <div class="dashboard">
    <!-- Sidebar -->
    <aside class="sidebar">
      <h2 class="logo">SIES-TES</h2>
      <nav>
        <ul>
          <li><a href="#" onclick="loadSection('students')">👨‍🎓 Students</a></li>
          <li><a href="#" onclick="loadSection('teachers')">👩‍🏫 Teachers</a></li>
          <li><a href="#" onclick="loadSection('questions')">❓ Questions</a></li>
          <li><a href="#" onclick="loadSection('ratings')">⭐ Ratings</a></li>
        </ul>
      </nav>
    </aside>

    <!-- Main content -->
    <main class="main-content">
      <header>
        <h1>Admin Dashboard</h1>
      </header>
      <section id="content-area">
        <p>Select a section from the sidebar to manage data.</p>
      </section>
    </main>
  </div>

<script>
  async function loadSection(section) {
    const content = document.getElementById("content-area");

    if (section === "students") {
      // Fetch students from backend
      const response = await fetch("/admin/students-data");
      const data = await response.json();

      let tableHTML = `
        <h2>Manage Students</h2>
        <button onclick="openAddModal()">➕ Add Student</button>
        <table>
          <thead>
            <tr>
              <th>ID</th><th>Name</th><th>Roll No</th><th>Class</th>
              <th>Year</th><th>Eligibility</th><th>Actions</th>
            </tr>
          </thead>
          <tbody>
      `;

      data.forEach(student => {
        tableHTML += `
          <tr>
            <td>${student.student_id}</td>
            <td>${student.name}</td>
            <td>${student.roll_no}</td>
            <td>${student.class_id}</td>
            <td>${student.admission_year}</td>
            <td>
              <button onclick="toggleEligibility('${student.student_id}', ${student.is_eligible})" 
                style="background:${student.is_eligible ? 'green' : 'red'};color:white">
                ${student.is_eligible ? 'Eligible' : 'Not Eligible'}
              </button>
            </td>
            <td>
              <button onclick="openEditModal(${JSON.stringify(student)})">✏️ Edit</button>
              <button onclick="deleteStudent('${student.student_id}')">🗑 Delete</button>
            </td>
          </tr>
        `;
      });

      tableHTML += "</tbody></table>";
      content.innerHTML = tableHTML;
    }
  }

  // ✅ Toggle eligibility
  async function toggleEligibility(studentId, currentStatus) {
    const formData = new FormData();
    formData.append("student_id", studentId);
    formData.append("is_eligible", !currentStatus);

    const response = await fetch("/admin/update-eligibility", {
      method: "POST",
      body: formData
    });

    if (response.ok) loadSection("students");
  }

  // ✅ Delete student
  async function deleteStudent(studentId) {
    if (!confirm("Are you sure you want to delete this student?")) return;

    const response = await fetch(`/admin/delete-student/${studentId}`, { method: "DELETE" });
    if (response.ok) loadSection("students");
  }

  // ✅ Open Add Modal
  function openAddModal() {
    alert("Here we’ll open Add Student modal (with form like Student Registration)");
  }

  // ✅ Open Edit Modal
  function openEditModal(student) {
    alert("Here we’ll open Edit Student modal with pre-filled values:\n" + JSON.stringify(student, null, 2));
  }
</script>

</body>
</html>
